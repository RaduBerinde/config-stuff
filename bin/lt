#!/bin/bash
timeout=10m
t='Test(Planner|)Logic$$'
if ! [[ "$1" = -* || "$1" = "" ]]; then
  if [[ "$1" == *\/* ]]; then
    t="$t/$1"
  else
    t="$t//$1"
    timeout=30s
  fi
  shift
fi
set -x

export COCKROACH_DISTSQL_LOG_PLAN=1
nice -n 19 make test PKG=./pkg/sql/logictest TESTS="$t" TESTFLAGS="-v --logtostderr NONE --show-logs --show-sql $*" TESTTIMEOUT=$timeout |& tee /tmp/log

set +x
echo ""
echo "** Summary **"
cat /tmp/log | grep -E --color=never 'PASS|FAIL'
